jQuery(function($){var $bd=$("body"),$appWrap=$("#pcld-app-wrap"),$loader=$("#ppb-loading-overlay"),$mydesigns=$("#pcld-my-designs"),$communitydesigns=$("#pcld-comm-designs"),$nameDlg=$("#pcld-tpl-name-dlg"),$tplName=$("#pcld-tpl-name");$nameDlg.ppbDialog({dialogClass:"ppb-dialog-wilson",autoOpen:false,draggable:false,resizable:false,title:"Template name",width:"auto",height:"auto",buttons:{"Create Template":function(){var tpl=JSON.parse(ppbTemplateFromRow(ppbRowI));tpl.name=$tplName.val();if(!tpl.name){return alert("Please type in a name...")}pcld.appWin.postMessage({pcldCallback:"saveTemplate",payload:tpl},"*");$loader.fadeIn();ppbNotify("Pootle Cloud: Template saved successfully");$tplName.val("");$nameDlg.ppbDialog("close")}}});$("#pcld-template-tabs").ppbTabs();pcld={populateTemplates:function($templates,tpls,callback){if(typeof callback!=="function"){callback=function(){}}$templates.html("");for(var i=0;i<tpls.length;i++){var tpl=tpls[i];ppbDesignTpls[tpl.name]=tpl;var $tpl=$('<div class="ppb-tpl" data-id="'+tpl.name+'"></div>');if(!tpl.img){var style=JSON.parse(tpl.style),color=style.background||style.grad_col1||style.grad_col2;$tpl.html('<div class="ppb-tpl-bg" style="padding-top:52%;background:'+color+'"></div>')}else{$tpl.html('<img src="'+tpl.img+'" alt="'+tpl.name+'"/>')}callback(tpl,$tpl);$tpl.append('<i class="fa fa-search"></i>');$templates.append($tpl)}},postMsgActions:{loggedIn:function(){$bd.addClass("pcld-logged-in");$appWrap.fadeOut();if(pcld.showLogin){ppbNotify("Pootle Cloud: Log in successful")}},loggedOut:function(){$bd.removeClass("pcld-logged-in")},templates:function(tpls){pcld.templates=tpls;pcld.populateTemplates($mydesigns,tpls);$mydesigns.append("<h4>Please "+'<a href="javascript:pcld.loginPopup()" style="color: #28d">login to your Pootle Cloud account</a>'+" and save some templates.</h4>")},doneLoading:function(){$loader.fadeOut()}},saveRow:function(){if($bd.hasClass("pcld-logged-in")){$nameDlg.ppbDialog("open")}else{alert("You need to login to your pootle cloud account before you can save templates.")}},manage:function(){$appWrap.fadeIn()},logout:function(){pcld.appWin.postMessage({pcldCallback:"logout"},"*")},loginPopup:function(){pcld.showLogin=true;$appWrap.fadeIn()},receiveMessage:function(e){var callback,payload,msg=e[e.message?"message":"data"];if(e.origin.replace(/http[s]?:\/\//,"").indexOf(pcldData.appUrl)&&msg.pcldCallback){callback=msg.pcldCallback;payload=msg.payload;if(typeof pcld.postMsgActions[callback]==="function"){pcld.postMsgActions[callback](payload);pcld.appWin=e.source}}}};$.get("https://pootle-cloud.firebaseio.com/comm.json?orderBy=%22love%22&startAt=2",function(data){if(typeof data==="object"&&data){var tpls=[];for(var tpl in data){tpls.push(data[tpl])}pcld.populateTemplates($communitydesigns,tpls,function(tpl,$tpl){if(tpl.author){var $author=$("<div/>").addClass("tpl-author");if(tpl.authorLink){$author.html('<a href="'+tpl.authorLink+'">'+tpl.author+"</a>")}else{$author.html(tpl.author)}$tpl.prepend($author)}})}else{console.error("Failed to get community templates data")}});window.addEventListener("message",pcld.receiveMessage,false)});